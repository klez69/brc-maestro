<!DOCTYPE html>
<html lang="pl">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Logowanie do Panelu Administracyjnego | Salon Migdał</title>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
		<link
			href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=Montserrat:wght@300;400;600&display=swap"
			rel="stylesheet"
		/>
		<script src="../js/visitor-tracker.js"></script>
		<style>
			:root {
				--brown: #8b6d5c;
				--light-brown: #a58d7f;
				--cream: #f5f1e8;
				--white: #ffffff;
				--dark: #2d2a26;
				--border-color: #e9ecef;
				--border-radius: 6px;
				--box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			}

			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
				font-family: 'Montserrat', sans-serif;
			}

			body {
				background-color: var(--cream);
				display: flex;
				justify-content: center;
				align-items: center;
				min-height: 100vh;
				padding: 20px;
			}

			.login-container {
				width: 100%;
				max-width: 400px;
				background-color: var(--white);
				border-radius: var(--border-radius);
				box-shadow: var(--box-shadow);
				overflow: hidden;
			}

			.login-header {
				background-color: var(--brown);
				color: var(--white);
				padding: 30px;
				text-align: center;
			}

			.login-header h1 {
				font-family: 'Cormorant Garamond', serif;
				font-size: 28px;
				margin-bottom: 10px;
				font-weight: 600;
			}

			.login-header p {
				font-size: 14px;
				opacity: 0.9;
			}

			.login-form {
				padding: 30px;
			}

			.form-group {
				margin-bottom: 20px;
			}

			.form-group label {
				display: block;
				margin-bottom: 8px;
				font-size: 14px;
				font-weight: 500;
				color: var(--dark);
			}

			.input-group {
				position: relative;
			}

			.input-group i {
				position: absolute;
				top: 50%;
				left: 15px;
				transform: translateY(-50%);
				color: var(--light-brown);
			}

			.input-group input {
				width: 100%;
				padding: 12px 15px 12px 45px;
				border: 1px solid var(--border-color);
				border-radius: var(--border-radius);
				font-size: 14px;
				transition: all 0.3s ease;
			}

			.input-group input:focus {
				border-color: var(--brown);
				box-shadow: 0 0 0 3px rgba(139, 109, 92, 0.1);
				outline: none;
			}

			.forgot-password {
				display: block;
				text-align: right;
				font-size: 14px;
				color: var(--brown);
				margin-bottom: 20px;
				text-decoration: none;
			}

			.forgot-password:hover {
				text-decoration: underline;
			}

			.login-btn {
				display: block;
				width: 100%;
				padding: 12px;
				background-color: var(--brown);
				color: var(--white);
				border: none;
				border-radius: var(--border-radius);
				font-size: 16px;
				font-weight: 500;
				cursor: pointer;
				transition: all 0.3s ease;
			}

			.login-btn:hover {
				background-color: var(--light-brown);
			}

			.login-footer {
				display: flex;
				justify-content: center;
				padding: 20px 30px;
				background-color: var(--cream);
				border-top: 1px solid var(--border-color);
			}

			.login-footer a {
				color: var(--brown);
				text-decoration: none;
				font-size: 14px;
			}

			.login-footer a:hover {
				text-decoration: underline;
			}

			.error-message {
				background-color: rgba(220, 53, 69, 0.1);
				color: #dc3545;
				padding: 10px;
				border-radius: var(--border-radius);
				font-size: 14px;
				margin-bottom: 20px;
				display: none;
			}

			.error-message.show {
				display: block;
			}

			@media (max-width: 480px) {
				.login-header {
					padding: 20px;
				}

				.login-form {
					padding: 20px;
				}
			}

			.bg-brown {
				background-color: var(--brown);
			}

			.text-brown {
				color: var(--brown);
			}

			.border-brown {
				border-color: var(--brown);
			}

			.animate-wiggle {
				animation: wiggle 0.5s ease-in-out 1;
			}

			@keyframes wiggle {
				0%,
				100% {
					transform: translateX(0);
				}
				25% {
					transform: translateX(-5px);
				}
				75% {
					transform: translateX(5px);
				}
			}

			/* Debug info styles */
			.debug-info {
				background-color: #f8f9fa;
				border: 1px solid #ddd;
				border-radius: 4px;
				padding: 10px;
				margin-top: 20px;
				font-size: 12px;
				color: #666;
				display: none;
			}

			.debug-info.show {
				display: block;
			}
		</style>
	</head>
	<body class="bg-cream">
		<div class="flex items-center justify-center min-h-screen p-4">
			<div class="max-w-md w-full bg-white rounded-lg shadow-lg p-8">
				<div class="text-center mb-8">
					<h1 class="text-3xl font-semibold text-brown mb-2">Panel Administracyjny</h1>
					<p class="text-gray-600">Salon Fryzjerski Migdał</p>
				</div>

				<!-- Komunikat o błędzie -->
				<div id="error-message" class="bg-red-100 text-red-700 p-3 rounded-md mb-4 hidden"></div>

				<!-- Prosty formularz logowania -->
				<form id="loginForm" class="space-y-6" action="../login_direct.php" method="post">
					<!-- Nazwa użytkownika -->
					<div class="mb-4">
						<label for="username" class="block text-sm font-medium text-gray-700 mb-2">Nazwa użytkownika</label>
						<input
							type="text"
							id="username"
							name="username"
							class="w-full py-2 px-3 border border-gray-300 rounded-md"
							required
						/>
					</div>

					<!-- Hasło -->
					<div class="mb-4">
						<label for="password" class="block text-sm font-medium text-gray-700 mb-2">Hasło</label>
						<input
							type="password"
							id="password"
							name="password"
							class="w-full py-2 px-3 border border-gray-300 rounded-md"
							required
						/>
					</div>

					<!-- Zapamiętaj mnie -->
					<div class="mb-4">
						<label class="flex items-center">
							<input type="checkbox" id="remember" name="remember" class="mr-2" />
							<span class="text-sm text-gray-700">Zapamiętaj mnie</span>
						</label>
					</div>

					<!-- Główny przycisk logowania -->
					<div>
						<button
							type="submit"
							id="login-btn"
							class="w-full bg-brown hover:bg-light-brown text-white font-medium py-2 px-4 rounded-md"
						>
							Zaloguj się
						</button>
					</div>
				</form>

				<!-- Alternatywny przycisk logowania dla rozwiązania problemów-->
				<div class="mt-3">
					<button
						onclick="loginAlternative()"
						class="w-full text-brown border border-brown py-2 px-4 rounded-md text-sm"
					>
						Logowanie alternatywne
					</button>
				</div>

				<!-- Debug button -->
				<div class="mt-2 text-center">
					<button id="debug-toggle" onclick="toggleDebugInfo()" class="text-xs text-gray-500 hover:underline">
						Pokaż/ukryj informacje debugowania
					</button>
				</div>

				<!-- Debug info -->
				<div id="debug-info" class="debug-info">
					<h3 class="font-bold mb-2">Informacje debugowania:</h3>
					<div id="session-info"></div>
					<div id="browser-info" class="mt-2"></div>
					<div id="cookies-info" class="mt-2"></div>
				</div>

				<div class="mt-6 text-center">
					<a href="../index.html" class="text-sm text-brown hover:underline">
						<i class="fas fa-arrow-left mr-1"></i> Powrót do strony głównej
					</a>
				</div>
			</div>
		</div>

		<script>
			document.addEventListener('DOMContentLoaded', function () {
				console.log('Login form script loaded')

				// Sprawdź URL, czy zawiera parametr error
				const urlParams = new URLSearchParams(window.location.search)
				const errorParam = urlParams.get('error')
				const errorReason = urlParams.get('reason')

				if (errorParam) {
					const errorMessage = document.getElementById('error-message')

					if (errorMessage) {
						// Ustawienie odpowiedniego komunikatu błędu
						if (errorParam === 'auth') {
							if (errorReason === 'empty') {
								errorMessage.textContent = 'Wprowadź nazwę użytkownika i hasło.'
							} else if (errorReason === 'invalid_password') {
								errorMessage.textContent = 'Nieprawidłowe hasło.'
							} else {
								errorMessage.textContent = 'Nieprawidłowa nazwa użytkownika lub hasło.'
							}
						} else if (errorParam === 'session') {
							errorMessage.textContent = 'Sesja wygasła. Zaloguj się ponownie.'
						} else if (errorParam === 'csrf') {
							errorMessage.textContent = 'Błąd zabezpieczeń. Spróbuj ponownie.'
						} else if (errorParam === 'server') {
							errorMessage.textContent = 'Błąd serwera. Spróbuj ponownie później.'
						} else if (errorParam === 'method') {
							errorMessage.textContent = 'Nieprawidłowa metoda żądania. Użyj formularza logowania.'
						}

						// Pokaż komunikat błędu
						errorMessage.classList.remove('hidden')
					}
				}

				// Utwórz informacje debugowania
				updateDebugInfo()

				// Sprawdź, czy użytkownik jest już zalogowany
				checkLoginStatus()
			})

			// Funkcja sprawdzająca status logowania
			function checkLoginStatus() {
				const isLoggedInLS = localStorage.getItem('adminLoggedIn') === 'true'
				const isLoggedInSS = sessionStorage.getItem('adminLoggedIn') === 'true'

				if (isLoggedInLS || isLoggedInSS) {
					console.log('Przekierowanie do weryfikacji sesji')
					window.location.href = '../verify_session.php'
				}
			}

			// Funkcja do aktualizacji informacji debugowania
			function updateDebugInfo() {
				const sessionInfo = document.getElementById('session-info')
				const browserInfo = document.getElementById('browser-info')
				const cookiesInfo = document.getElementById('cookies-info')

				// Informacje o sesji
				sessionInfo.innerHTML =
					'<strong>Local Storage:</strong> adminLoggedIn = ' +
					(localStorage.getItem('adminLoggedIn') || 'nie ustawiono') +
					'<br><strong>Session Storage:</strong> adminLoggedIn = ' +
					(sessionStorage.getItem('adminLoggedIn') || 'nie ustawiono')

				// Informacje o przeglądarce
				browserInfo.innerHTML = '<strong>Przeglądarka:</strong> ' + navigator.userAgent

				// Informacje o ciasteczkach
				cookiesInfo.innerHTML = '<strong>Cookies:</strong> ' + (document.cookie ? document.cookie : 'brak cookies')
			}

			// Funkcja do przełączania widoczności informacji debugowania
			function toggleDebugInfo() {
				const debugInfo = document.getElementById('debug-info')
				debugInfo.classList.toggle('show')

				// Aktualizuj informacje debugowania przy każdym pokazaniu
				if (debugInfo.classList.contains('show')) {
					updateDebugInfo()
				}
			}

			// Funkcja alternatywnego logowania - wysyła dane bezpośrednio do auth.php
			function loginAlternative() {
				const username = document.getElementById('username').value
				const password = document.getElementById('password').value
				const remember = document.getElementById('remember').checked

				if (!username || !password) {
					alert('Wprowadź nazwę użytkownika i hasło')
					return
				}

				// Tworzymy formularz i wysyłamy go
				const form = document.createElement('form')
				form.method = 'POST'
				form.action = '../auth.php'
				form.style.display = 'none'

				// Pole username
				const usernameInput = document.createElement('input')
				usernameInput.type = 'text'
				usernameInput.name = 'username'
				usernameInput.value = username
				form.appendChild(usernameInput)

				// Pole password
				const passwordInput = document.createElement('input')
				passwordInput.type = 'password'
				passwordInput.name = 'password'
				passwordInput.value = password
				form.appendChild(passwordInput)

				// Pole remember
				if (remember) {
					const rememberInput = document.createElement('input')
					rememberInput.type = 'checkbox'
					rememberInput.name = 'remember'
					rememberInput.checked = true
					form.appendChild(rememberInput)
				}

				// Token CSRF
				const tokenInput = document.createElement('input')
				tokenInput.type = 'hidden'
				tokenInput.name = 'token'
				tokenInput.value = 'bypass_token_' + Math.random().toString(36).substring(2)
				form.appendChild(tokenInput)

				// Dodajemy formularz do strony i wysyłamy
				document.body.appendChild(form)
				form.submit()
			}
		</script>
	</body>
</html>
